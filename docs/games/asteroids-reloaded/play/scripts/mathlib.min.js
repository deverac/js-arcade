var RAD=Math.PI/180,PI=Math.PI,TWOPI=2*Math.PI,ONEOPI=1/Math.PI,PIO2=Math.PI/2,PIO4=Math.PI/4,PIO8=Math.PI/8,PIO16=Math.PI/16,PIO32=Math.PI/32,Rnd=Math.random,Sin=Math.sin,Cos=Math.cos,Sqrt=Math.sqrt,Floor=Math.floor,Atan2=Math.atan2,Ceil=Math.ceil,Abs=Math.abs;function randomInt(t,n){return~~(Rnd()*(n-t+1)+t)}function weightedRandom(t){var n=Rnd();return n<.5?1-Math.pow(1-n,void 0!==t?t:2)/2:.5+Math.pow(2*(n-.5),void 0!==t?t:2)/2}function calcNormalVector(t,n,i,r,s,h){return new Vector3D(n*h-i*s,-(h*t-r*i),t*s-n*r).norm()}function extend(t,n,i){function r(){}if(r.prototype=n.prototype,t.prototype=new r,(t.prototype.constructor=t).superclass=n.prototype,n.prototype.constructor==Object.prototype.constructor&&(n.prototype.constructor=n),i)for(var s in i)i.hasOwnProperty(s)&&(t.prototype[s]=i[s])}function isArray(t){return-1!==t.constructor.toString().indexOf("Array")}!function(){Vector=function(t,n){return this.x=t,this.y=n,this},Vector.prototype={x:0,y:0,clone:function(){return new Vector(this.x,this.y)},set:function(t){return this.x=t.x,this.y=t.y,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},nadd:function(t){return new Vector(this.x+t.x,this.y+t.y)},sub:function(t){return this.x-=t.x,this.y-=t.y,this},nsub:function(t){return new Vector(this.x-t.x,this.y-t.y)},dot:function(t){return this.x*t.x+this.y*t.y},length:function(){return Sqrt(this.x*this.x+this.y*this.y)},distance:function(t){var n=this.x-t.x,t=this.y-t.y;return Sqrt(n*n+t*t)},theta:function(){return Atan2(this.y,this.x)},thetaTo:function(t){var n=this.clone().norm(),t=t.clone().norm();return Math.acos(n.dot(t))},thetaTo2:function(t){return Atan2(t.y,t.x)-Atan2(this.y,this.x)},norm:function(){var t=this.length();return this.x/=t,this.y/=t,this},nnorm:function(){var t=this.length();return new Vector(this.x/t,this.y/t)},rotate:function(a){var ca=Cos(a),sa=Sin(a);with(this){var rx=x*ca-y*sa,ry=x*sa+y*ca;x=rx,y=ry}return this},nrotate:function(t){var n=Cos(t),t=Sin(t);return new Vector(this.x*n-this.y*t,this.x*t+this.y*n)},invert:function(){return this.x=-this.x,this.y=-this.y,this},ninvert:function(){return new Vector(-this.x,-this.y)},scale:function(t){return this.x*=t,this.y*=t,this},nscale:function(t){return new Vector(this.x*t,this.y*t)},scaleTo:function(t){t/=this.length();return this.x*=t,this.y*=t,this},nscaleTo:function(t){t/=this.length();return new Vector(this.x*t,this.y*t)}}}(),Vector3D=function(t,n,i){return this.x=t,this.y=n,this.z=i,this},Vector3D.prototype={x:0,y:0,z:0,clone:function(){return new Vector3D(this.x,this.y,this.z)},set:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new Vector3D(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},distance:function(t){var n=this.x-t.x,i=this.y-t.y,t=this.z-t.z;return Sqrt(n*n+i*i+t*t)},thetaTo:function(t){var n=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,r=this.x*t.y-this.y*t.x;return Atan2(Sqrt(n*n+i*i+r*r),this.dot(t))},thetaTo2:function(t){return Math.acos(this.dot(t)/(Sqrt(this.x*this.x+this.y*this.y+this.z*this.z)*Sqrt(t.x*t.x+t.y*t.y+t.z*t.z)))},norm:function(){var t=this.length();return this.x/=t,this.y/=t,this.z/=t,this},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},Preloader=function(){return this.images=new Array,this},Preloader.prototype={images:null,callback:null,counter:0,addImage:function(t,n){var i=this;t.url=n,t.onload=function(){i.counter++,i.counter===i.images.length&&i.callback.call(i)},this.images.push(t)},onLoadCallback:function(t){this.counter=0,this.callback=t;for(var n=0,i=this.images.length;n<i;n++)this.images[n].src=this.images[n].url}};